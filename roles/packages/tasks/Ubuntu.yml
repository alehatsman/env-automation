---
- name: Make sure keys are updated
  shell: |
    apt-key adv --refresh-keys --keyserver keyserver.ubuntu.com

    apt-get update
    apt-get install -y gnupg software-properties-common curl ca-certificates apt-transport-https

    add-apt-repository ppa:longsleep/golang-backports

    curl -fsSL https://apt.releases.hashicorp.com/gpg | apt-key add -
    echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list


    curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -
    apt-add-repository "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main"
    apt-get update

  become: true

- name: Make sure apt packages are installed
  apt:
    name: '{{ apps }}'
    state: latest
    update_cache: true
  become: true

- name: Make sure all cargo deps are installed
  shell:
    cargo install {{ item }}
  with_items: '{{ cargo }}'
